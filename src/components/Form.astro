---
import Input from "./Inpunt.astro";
---

<section class="flex flex-col justify-center my-10 mx-5 lg:w-full">
    <form action="post" class="flex flex-col gap-6 max-w-[320px] lg:mx-auto">
        <div class="flex flex-col gap-6">
            <Input
                id="cardholderName"
                label="Cardholder Name"
                name="cardholderName"
                type="text"
                placeholder="e.g. Jane Appleseed"
                required={true}
                error=""
            />
            <Input
                id="cardNumber"
                label="Card Number"
                name="cardNumber"
                type="text"
                placeholder="e.g. 1234 5678 9123 0000"
                error=""
                maxlength="16"
                required={true}
            />
        </div>
        <div class="flex flex-col gap-2">
            <div class="grid grid-cols-4 grid-rows-1 gap-1">
                <Input
                    class="w-1/2"
                    label="exp. date"
                    id="month"
                    name="month"
                    type="text"
                    placeholder="MM"
                    maxlength="2"
                    required={true}
                    error=""
                />
                <Input
                    class="w-1/2"
                    label="(MM/YY)"
                    id="year"
                    name="year"
                    type="text"
                    placeholder="YY"
                    maxlength="2"
                    required={true}
                    error=""
                />
                <Input
                    id="cvc"
                    label="CVC"
                    name="cvc"
                    type="text"
                    placeholder="e.g. 123"
                    class="col-span-2"
                    required={true}
                    error=""
                />
            </div>
        </div>
        <button
            type="submit"
            class="w-full h-10 border rounded-lg text-white bg-[var(--purple-color)]"
            >Confirm</button
        >
    </form>
</section>

<script>
    //Listamos los campos
    const inputConfig = [
        { id: "cardholderName", isNumber: false },
        { id: "cardNumber", isNumber: true },
        { id: "month", isNumber: true },
        { id: "year", isNumber: true },
        { id: "cvc", isNumber: true },
    ];

    //bucle para recorrer los inputs
    inputConfig.forEach((field) => {
        const input = document.getElementById(field.id);
        const errorMsg = document.getElementById(`error-${field.id}`);

        if (input && errorMsg) {
            input.addEventListener("input", function (e) {
                const target = e.target as HTMLInputElement;
                const valor = target.value;
                //CASO 1. Si esta en blanco
                if (valor === "") {
                    errorMsg.style.display = "block";
                    errorMsg.textContent = "Can't be blank";
                    target.style.borderColor = "var(--error)";
                }
                //CASO 2. Solo n√∫meros
                else if (field.isNumber && /[^0-9]/.test(valor)) {
                    errorMsg.style.display = "block";
                    errorMsg.textContent = "Wrong format, numbers only";
                    target.style.borderColor = "var(--error)";
                    target.value = valor.replace(/[^0-9]/g, "");
                } else {
                    errorMsg.style.display = "none";
                    target.style.borderColor = "";
                }
            });
            input.addEventListener("blur", function (e) {
                const target = e.target as HTMLInputElement;
                const valor = target.value;
                if (valor === "") {
                    errorMsg.style.display = "block";
                    errorMsg.textContent = "Can't be blank";
                    target.style.borderColor = "var(--error)";
                }
            });
        }
    });
</script>
